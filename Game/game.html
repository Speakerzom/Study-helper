<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Game H·ªçc T·∫≠p ‚Äì Study Helper</title>
  <link rel="stylesheet" href="game.css"/>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: L·ªñI (thi·∫øu d·ªØ li·ªáu ƒë·∫ßu v√†o)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-error" class="screen hidden">
  <div class="error-card">
    <div class="err-icon">‚ö†Ô∏è</div>
    <h2>Thi·∫øu d·ªØ li·ªáu b√†i h·ªçc</h2>
    <p id="error-msg">Vui l√≤ng ch·ªçn b√†i t·ª´ module Luy·ªán t·∫≠p tr∆∞·ªõc khi v√†o game.</p>
    <a class="btn-back-practice" href="../Practice/practice.html">
      ‚Üê Quay v·ªÅ Luy·ªán t·∫≠p
    </a>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: PREPLASH VIDEO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-preplash" class="screen hidden">
  <video id="preplash-video" playsinline muted preload="auto">
    <source src="assets/preplash/preplash.mp4" type="video/mp4"/>
  </video>
  <div id="preplash-overlay">
    <div id="preplash-info">
      <div id="preplash-title"></div>
      <div id="preplash-sub"></div>
    </div>
    <div id="preplash-skip">Nh·∫•n ƒë·ªÉ b·ªè qua ‚ñ∂</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: M√ÄN CH∆†I CH√çNH (1 m√†n duy nh·∫•t)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-game" class="screen hidden">

  <!-- HUD -->
  <div id="hud">
    <div id="hud-left">
      <a class="hud-back" href="../Practice/practice.html" title="V·ªÅ Luy·ªán t·∫≠p">‚Üê</a>
      <div id="hud-lesson-name"></div>
    </div>
    <div id="hud-center">
      <span id="phase-badge" class="phase-normal">‚ö° NORMAL</span>
    </div>
    <div id="hud-right">
      <span class="energy-lbl">‚ö°</span>
      <div id="energy-bar-bg">
        <div id="energy-bar-fill"></div>
      </div>
      <span id="energy-text">0/0</span>
    </div>
  </div>

  <!-- CANVAS: n·ªÅn game + nh√¢n v·∫≠t -->
  <canvas id="game-canvas"></canvas>

  <!-- BOSS TIMER (ch·ªâ hi·ªán ·ªü phase boss) -->
  <div id="boss-timer" class="hidden">
    <svg id="timer-svg" viewBox="0 0 60 60">
      <circle cx="30" cy="30" r="26" class="t-bg"/>
      <circle cx="30" cy="30" r="26" class="t-ring" id="t-ring"/>
    </svg>
    <span id="timer-num">60</span>
  </div>

  <!-- N√öT TI·∫æN (normal phase) -->
  <button id="btn-advance">‚öîÔ∏è Ti·∫øn</button>

  <!-- ATTACK FLASH OVERLAY -->
  <div id="attack-flash" class="hidden"></div>

  <!-- KHUNG C√ÇU H·ªéI -->
  <div id="question-panel" class="hidden">

    <div id="q-frame">
      <span id="q-badge">4 l·ª±a ch·ªçn</span>
      <p id="q-text"></p>
    </div>

    <div id="a-frame">
      <div id="a-body">
        <!-- inject by game.js -->
      </div>
    </div>

    <!-- Explanation (hi·ªán sau khi tr·∫£ l·ªùi) -->
    <div id="q-explanation" class="hidden">
      <span id="expl-icon">‚úÖ</span>
      <span id="expl-text"></span>
    </div>

  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: THUA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-lose" class="screen hidden">
  <div class="end-bg-img" id="lose-bg"></div>
  <div class="end-card">
    <div class="end-icon">üíÄ</div>
    <h2 class="end-title lose-title">Th·∫•t b·∫°i!</h2>
    <p class="end-sub">NƒÉng l∆∞·ª£ng ƒë√£ c·∫°n ki·ªát. H√£y c·ªë g·∫Øng h∆°n!</p>
    <div class="end-stats" id="lose-stats"></div>
    <div class="end-btns">
      <button class="btn-end btn-retry" id="btn-retry">üîÑ Ch∆°i l·∫°i</button>
      <a class="btn-end btn-to-practice" id="btn-lose-back" href="../Practice/practice.html">‚Üê Luy·ªán t·∫≠p</a>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: TH·∫ÆNG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-win" class="screen hidden">
  <div class="end-bg-img" id="win-bg"></div>
  <div class="end-card">
    <div class="end-icon">üèÜ</div>
    <h2 class="end-title win-title">Chi·∫øn th·∫Øng!</h2>
    <p class="end-sub">B·∫°n ƒë√£ ƒë√°nh b·∫°i Boss! Xu·∫•t s·∫Øc!</p>
    <div class="end-stats" id="win-stats"></div>
    <div class="end-btns">
      <button class="btn-end btn-complete" id="btn-complete">‚úÖ Ho√†n th√†nh</button>
      <button class="btn-end btn-retry-win" id="btn-retry-win">üîÑ Ch∆°i l·∫°i</button>
    </div>
  </div>
</div>

<script src="game.js"></script>
<script>
  /* G·∫Øn URL c√≥ params cho n√∫t quay v·ªÅ Practice sau khi game.js ch·∫°y xong */
  (function patchBackLinks() {
    const p = new URLSearchParams(location.search);
    const cls  = p.get('class')   || '';
    const subj = p.get('subject') || '';
    const les  = p.get('lesson')  || '';
    const base = '../Practice/practice.html';
    const url  = `${base}?class=${encodeURIComponent(cls)}&subject=${encodeURIComponent(subj)}&lesson=${encodeURIComponent(les)}`;

    /* N√∫t Back trong screen-lose */
    const loseBack = document.getElementById('btn-lose-back');
    if (loseBack) loseBack.href = url;

    /* N√∫t Back trong HUD (n√∫t ‚Üê ·ªü g√≥c tr√°i) */
    const hudBack = document.querySelector('.hud-back');
    if (hudBack) hudBack.href = url;
  })();
</script>
</body>
</html>
